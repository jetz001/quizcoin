# QuizCoin (QZC) Tokenomics และบทบาทของ Smart Contract

เอกสารนี้จะอธิบายโทเคโนมิคส์หลักของ QuizCoin (QZC) บทบาทของสัญญาอัจฉริยะ และกลไกเกมภายในระบบนิเวศเกมตอบคำถามแบบกระจายศูนย์

---

## 1. ภาพรวม Tokenomics ของ QuizCoin (QZC)

### 1.1 อุปทานสูงสุด (Max Supply): ไม่จำกัด (Unlimited)
* QZC มีอุปทานรวม **ไม่จำกัด**
* **กลไกการสร้าง:** เหรียญ QuizCoin จะถูก "Mint" (สร้างขึ้นใหม่) โดยเฉพาะเมื่อผู้เล่นตอบคำถามในเกม QuizGame ได้ถูกต้องเป็นครั้งแรก **และได้รับการยืนยันจาก Backend** (ไม่ว่าจะเล่นในโหมด Solo หรือ Pool)

### 1.2 การแจกจ่ายเริ่มต้น (Initial Distribution): ไม่มี (None)
* จะ **ไม่มีการ Mint เหรียญล่วงหน้า, การแจกจ่ายเริ่มต้น หรือการทำ Airdrop** ของเหรียญ QZC
* ณ เวลาที่ deploy สัญญา QuizCoin อุปทานรวมของเหรียญจะเริ่มต้นที่ศูนย์
* อุปทานของเหรียญจะเริ่มหมุนเวียนในระบบนิเวศก็ต่อเมื่อผู้เล่นเริ่มได้รับรางวัลจากการตอบคำถามได้อย่างถูกต้องเท่านั้น

### 1.3 คลังสมบัติ / กองทุนระบบนิเวศ (Treasury / Ecosystem Fund)
ความยั่งยืนและการพัฒนาของโปรเจกต์ได้รับการสนับสนุนจากคลังสมบัติโดยเฉพาะ ซึ่งบริหารจัดการโดย Diamond Contract

* **1.3.1 แหล่งที่มาของเงินทุน:**
    * **ค่าธรรมเนียมรางวัล 0.5%:** เมื่อมีผู้เล่นตอบคำถามถูก (ไม่ว่าจะเล่นในโหมด Solo หรือ Pool) รางวัลรวมที่คำนวณได้ 0.5% จะถูก Mint และส่งตรงไปยัง **Diamond Contract** ซึ่งทำหน้าที่เป็นคลังสมบัติหลักของโปรเจกต์
    * **ค่าธรรมเนียมการซื้อ Hint:** เหรียญ QuizCoin ที่ผู้เล่นใช้ในการซื้อ Hint (คำใบ้) จะถูกโอน **โดยตรง** จากกระเป๋าเงินของผู้เล่นไปยัง **Diamond Contract (คลังสมบัติ)**
* **1.3.2 วัตถุประสงค์การใช้งาน:**
    * ครอบคลุมค่าใช้จ่ายในการดำเนินงาน เช่น ค่าเช่าโดเมน
    * ค่าใช้จ่ายในการพัฒนา (Development Costs)
    * ค่าใช้จ่ายอื่นๆ ที่เกี่ยวข้องกับการบำรุงรักษาและพัฒนาระบบนิเวศของ QuizCoin

---

## 2. กลไกเกมและฟีเจอร์

### 2.1 โหมดการเล่นเกม (Game Modes)
เกม QuizCoin มี 2 โหมดหลัก โดยมีกลไกรางวัลและการเล่นที่แตกต่างกัน:

* **2.1.1 โหมด Solo (ระดับ 1-99):**
    * **ผู้ชนะ:** ผู้เล่นคนแรกที่ตอบคำถามถูกต้องในรอบคำถามนั้น **และได้รับการยืนยันจาก Backend** จะได้รับรางวัลเต็มจำนวนของระดับคำถามนั้น (หลังหักค่าธรรมเนียม Treasury 0.5%)
    * **สถานะคำถาม:** เมื่อมีผู้ชนะในโหมด Solo คำถามนั้นจะถูกปิดสำหรับโหมด Solo ทันที และไม่มีผู้เล่นอื่นสามารถตอบในโหมด Solo ได้อีกในรอบคำถามนั้น
* **2.1.2 โหมด Pool (ระดับ 1-99):**
    * **ช่วงเวลาตอบ:** เมื่อมีผู้เล่นคนแรกตอบคำถามถูกต้องในโหมด Pool ระบบจะเริ่มนับเวลาถอยหลัง 3 นาที (ช่วงเวลา Pool) เพื่อให้ผู้เล่นคนอื่นมีโอกาสเข้าร่วมตอบคำถาม
    * **การแจกจ่ายรางวัล:** หลังสิ้นสุดช่วงเวลา Pool (3 นาที) รางวัลรวมของคำถามนั้น (หลังหักค่าธรรมเนียม Treasury 0.5%) จะถูกแบ่งเท่าๆ กันระหว่างผู้เล่นทุกคนที่ตอบถูกต้องภายในช่วงเวลานั้น
* **2.1.3 คำถามระดับ 100 (ระดับพิเศษ):**
    * **ความถี่:** มีเพียง 1 คำถามต่อวัน
    * **รางวัล:** ผู้ตอบถูก (ไม่ว่าจะ Solo หรือ Pool) จะได้รับรางวัลคงที่ 10,000 QZC **โดยไม่มีการ Halving**
    * **รูปแบบคำตอบ:** เป็นช่องข้อความ (textbox) สำหรับใส่ตัวเลขทศนิยม 2 ตำแหน่ง โดยมีการปัดขึ้นเมื่อทศนิยมตำแหน่งที่สามเป็น 0.005 (เช่น 0.005 ปัดขึ้นเป็น 0.01)

### 2.2 กลไกรางวัลและการตอบคำถาม

* **รางวัลสำหรับระดับ 1-99:** ผู้เล่นจะได้รับรางวัลระหว่าง 1-5,000 QZC ขึ้นอยู่กับระดับความยากของคำถาม
* **กลไก Halving:** รางวัลสำหรับคำถามระดับ 1-99 จะถูกลดลงครึ่งหนึ่ง ("Halving") ทุก 4 ปี เพื่อควบคุมอุปทานและสร้างความยั่งยืนในระยะยาว
* **ความถี่ในการตอบ:**
    * **1 การตอบต่อ Wallet ต่อคำถาม:** แต่ละ Wallet สามารถตอบคำถามได้เพียง 1 ครั้งต่อคำถามนั้นๆ ในแต่ละรอบคำถาม
    * **ตอบซ้ำได้ในวันถัดไป:** ผู้เล่นสามารถตอบคำถามเดิมได้อีกครั้งในวันถัดไป หากคำถามนั้นยังไม่ถูกปิด
* **การเลือกโหมด:** แต่ละ Wallet สามารถเลือกเล่นได้เพียง 1 โหมด (Solo หรือ Pool) ต่อวัน และจะสามารถเลือกโหมดใหม่ได้ในวันถัดไป
* **การอ้างอิงเวลาของคำถาม (ควบคุมโดย Backend):**
    * **ระยะเวลาคำถาม (ระดับ 1-99):** คำถาม 1 คำถาม จะมีระยะเวลา 3 นาที
    * **ระยะเวลาคำถาม (ระดับ 100):** คำถามระดับ 100 จะมีระยะเวลา 1 วัน (24 ชั่วโมง UTC 00:00 - 23:59)

### 2.3 ระบบ Hint (คำใบ้)
* ผู้เล่นสามารถซื้อ Hint (คำใบ้) เพื่อช่วยในการตอบคำถามได้
* ค่าใช้จ่ายในการซื้อ Hint จะถูกโอนเป็นเหรียญ QZC โดยตรงเข้าสู่ Treasury ของ Diamond Contract

### 2.4 การสร้างคำถามและ Question Bank
* คำถามจะถูกสร้างขึ้นโดย **ปัญญาประดิษฐ์ (AI)** และคำตอบที่ถูกต้องจะถูก **Hash + Salt** ไว้
* **2.4.1 Question Real-time Generate (優先):**
    * ระบบจะเรียก **AI API (Gemini)** เพื่อสร้างคำถามแบบเรียลไทม์ (เมื่อถึงเวลาที่ต้องมีคำถามใหม่)
    * คำถามที่สร้างได้จะถูกนำไปใช้ในรอบคำถามนั้นๆ ทันที
    * หากการเรียก AI API ล้มเหลว หรือไม่สามารถเชื่อมต่อได้ ระบบจะสลับไปดึงคำถามจาก **Question Bank** สำรองแทน (ตามข้อ 2.4.2)
    * **การกลับมาใช้ AI อัตโนมัติ:** เมื่อ AI API กลับมาทำงานได้ตามปกติ Backend จะสลับกลับไปใช้ AI สำหรับการสร้างคำถามในรอบถัดไปโดยอัตโนมัติ
* **2.4.2 Question Bank (คลังคำถามสำรอง):** มี Question Bank สำรองไว้สำหรับเก็บคำถามในกรณีที่มีเหตุขัดข้องหรือไม่สามารถเชื่อมต่อกับ AI ได้ตามปกติ
    * **การจัดเก็บ:** คำถามทั้งหมดใน Question Bank จะถูกสร้างและเก็บไว้แบบ Off-chain โดยถูก **Hash + Salt** ทั้งคำถาม, ตัวเลือก และคำตอบ และจะไม่มีการปรับเปลี่ยนคำถามเหล่านี้ตลอดระยะเวลาที่ถูกเก็บไว้
    * สำหรับคำถามระดับ 1-99: เก็บคำถามล่วงหน้าไว้ 10 ปี หรือประมาณ 1,752,000 คำถาม
    * สำหรับคำถามระดับ 100: เก็บคำถามล่วงหน้าไว้ 3,650 คำถาม
    * **การดูแล:** คลังคำถามนี้จะถูกเคลียร์ทิ้งและสร้างใหม่ทุก 10 ปี เพื่อให้คำถามมีความทันสมัยและหลากหลาย
* **2.4.3 หมวดหมู่คำถาม:** คำถามทั้งหมดจะเป็นเฉพาะหมวด **วิทยาศาสตร์** และ **คณิตศาสตร์** เท่านั้น

---

## 3. กลไกและบทบาทของ Smart Contracts (ตามโครงสร้างปัจจุบัน)

### 3.1 `QuizCoin.sol` (ERC-20 Token)
* เป็นสัญญา ERC-20 มาตรฐานสำหรับ QuizCoin (QZC)
* **ไม่มีการ Mint เหรียญเริ่มต้น** ใน Constructor (Total Supply เริ่มต้นเป็น 0)
* ใช้ `AccessControl` ของ OpenZeppelin เพื่อจัดการ Role
* มี `MINTER_ROLE` ที่อนุญาตให้เฉพาะบทบาทนี้สามารถเรียกฟังก์ชัน `mint()` เพื่อสร้างเหรียญใหม่ได้
* มีฟังก์ชัน `MINTER_ROLE()` เพื่อให้สัญญาอื่นสามารถอ้างอิง Role Hash ได้

### 3.2 `PoolManager.sol`
ทำหน้าที่เป็นศูนย์กลางในการจัดการการ Mint และการโอน QuizCoin

* `withdrawForUser(address _user, uint256 _amount)`: ฟังก์ชันนี้จะถูกเรียกโดย QuizGameDiamond (Facet) เพื่อ **Mint เหรียญใหม่** จำนวน `_amount` และส่งให้ `_user` โดยตรงเมื่อผู้เล่นตอบถูก
* `mintAndTransferToTreasury(uint256 _amount)`: ฟังก์ชันนี้จะถูกเรียกโดย QuizGameDiamond (Facet) เพื่อ **Mint เหรียญใหม่** จำนวน `_amount` และส่งไปยัง Diamond Contract Address (ซึ่งทำหน้าที่เป็น Treasury)
* `deposit(uint256 _amount)`: ฟังก์ชันนี้อนุญาตให้ผู้ดูแลระบบ (Admin) หรือสัญญาที่ได้รับอนุญาตสามารถเติม QuizCoin เข้าสู่ `PoolManager` สำหรับวัตถุประสงค์เฉพาะอื่นๆ ได้ (เช่น การเพิ่มสภาพคล่อง, การสนับสนุนกิจกรรมพิเศษ) **ทั้งนี้ ค่าธรรมเนียมจากการซื้อ Hint จะถูกโอนโดยตรงจากผู้เล่นไปยัง Diamond Contract (Treasury) และไม่ผ่านฟังก์ชันนี้**
* `setQuizGameDiamondAddress(address _newQuizGameDiamondAddress)`: ถูกเพิ่มเข้ามาเพื่อให้ PoolManager รู้ว่าใครคือ Diamond Contract ที่ได้รับอนุญาตให้เรียกฟังก์ชัน Mint/Withdraw ได้
* **การมอบ `MINTER_ROLE`:** `PoolManager` จะได้รับ `MINTER_ROLE` บนสัญญา QuizCoin ในระหว่างการ Initialize ของ `QuizGameDiamond`

### 3.3 `QuizGameDiamond.sol` (Diamond Proxy)
เป็นสัญญาหลักที่ผู้ใช้จะโต้ตอบด้วย (เป็น Proxy)

* ใช้ `UUPSUpgradeable` และ `AccessControlUpgradeable`
* ใน `initialize()`:
    * มอบ `DEFAULT_ADMIN_ROLE` ให้กับผู้ที่ Deploy
    * **สำคัญ:** จะทำการ `grantRole(QuizCoin.MINTER_ROLE(), PoolManager Address)` ให้ `PoolManager` มีสิทธิ์ Mint เหรียญ QuizCoin
    * จะเรียก `PoolManager.setQuizGameDiamondAddress(address(this))` เพื่อให้ `PoolManager` รู้จัก Diamond Contract
* **บทบาทของ Treasury:** เป็นที่อยู่ของ Treasury (ค่าธรรมเนียม `buyHint` และ 0.5% จะถูกส่งมาที่นี่)

### 3.4 `LibAppStorage.sol` (Library)
* จัดการ `AppStorage` ซึ่งเป็นที่เก็บ State Variables ทั้งหมดของ QuizGame ที่ Facets ทุกตัวจะเข้าถึงร่วมกัน
* มี `TREASURY_FEE_PERCENTAGE` (กำหนดเป็น 50 สำหรับ 0.5%)
* มีฟังก์ชัน `_calculateCurrentReward()` ที่คำนวณรางวัลหลังจาก Halving

### 3.5 `QuizGameModeFacet.sol`
จัดการ Logic การสร้างคำถาม (`createQuestion`) และการส่งคำตอบ (`submitAnswer`)

* **3.5.1 ใน `submitAnswer` (Solo Mode):**
    * คำนวณ `totalReward`
    * คำนวณ `treasuryFee = totalReward * 0.5%`
    * เรียก `ds.poolManager.mintAndTransferToTreasury(treasuryFee)` (Mint ให้ Treasury)
    * เรียก `ds.poolManager.withdrawForUser(msg.sender, rewardForSoloSolver)` (Mint ที่เหลือให้ผู้เล่น)
* **3.5.2 ใน `buyHint()`:**
    * ผู้เล่นจะต้อง `approve` QuizCoin ให้กับ Diamond Contract Address ก่อน
    * ค่า `HINT_COST_AMOUNT` จะถูก `transferFrom` จากผู้เล่นไปยัง Diamond Contract (`address(this)`) โดยตรง ซึ่งหมายความว่าค่า Hint จะเข้าสู่ Treasury ทันที

### 3.6 `QuizGameRewardFacet.sol`
จัดการ Logic การแจกจ่ายรางวัลสำหรับ Pool Mode (`distributeRewards`)

* **3.6.1 ใน `distributeRewards`:**
    * คำนวณ `totalFinalReward`
    * คำนวณ `treasuryFee = totalFinalReward * 0.5%`
    * เรียก `ds.poolManager.mintAndTransferToTreasury(treasuryFee)` (Mint ให้ Treasury)
    * คำนวณ `rewardPerSolver` จากรางวัลที่เหลือ
    * เรียก `ds.poolManager.withdrawForUser(solver, rewardPerSolver)` (Mint ที่เหลือให้ผู้เล่นใน Pool)

### 3.7 สรุปการทำงานของ Treasury Fund จาก Tokenomics:
* **การซื้อ Hint:** QuizCoin ที่ใช้ซื้อ Hint จะถูกโอนโดยตรงเข้าสู่ Diamond Contract (ซึ่งทำหน้าที่เป็น Treasury)
    * *อ้างอิง:* `contracts\facets\QuizGameModeFacet.sol::buyHint`
* **ค่าธรรมเนียม 0.5% จากรางวัล:** เมื่อรางวัลถูกคำนวณแล้ว (ทั้ง Solo และ Pool) 0.5% ของรางวัลนั้นจะถูก Mint โดย `PoolManager` และโอนเข้า Diamond Contract (Treasury)
    * *อ้างอิง:* `contracts\facets\QuizGameModeFacet.sol::submitAnswer`
    * *อ้างอิง:* `contracts\facets\QuizGameRewardFacet.sol::distributeRewards`

---

## 4. ข้อจำกัดความรับผิดชอบ (Disclaimer)

QuizCoin (QZC) ได้รับการออกแบบให้เป็นโทเค็นยูทิลิตี้ในเกมสำหรับระบบนิเวศเกม QuizCoin และไม่ควรถือเป็นการลงทุนหรือเครื่องมือทางการเงินใดๆ มูลค่าของมันมาจากประโยชน์ใช้สอยภายในเกมเท่านั้น ผู้ใช้ควรศึกษาข้อมูลด้วยตนเองและทำความเข้าใจความเสี่ยงที่เกี่ยวข้องกับแอปพลิเคชันแบบกระจายศูนย์และคริปโทเคอร์เรนซีก่อนเข้าร่วม